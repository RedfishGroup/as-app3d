<!DOCTYPE html>

<html>
<head>
  <title>util.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="DataSet.html">
                  DataSet.js
                </a>
              
                
                <a class="source" href="OofA.html">
                  OofA.js
                </a>
              
                
                <a class="source" href="app.html">
                  app.js
                </a>
              
                
                <a class="source" href="util.html">
                  util.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>util.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>A set of useful misc utils which will eventually move to individual modules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> util = {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h3 id="types">Types</h3>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Fixing the javascript <a href="https://goo.gl/Efdzk5">typeof operator</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  typeOf: obj =&gt; ({}).toString.call(obj).match(<span class="hljs-regexp">/\s(\w+)/</span>)[<span class="hljs-number">1</span>].toLowerCase(),
  isAorO: obj =&gt; [<span class="hljs-string">'array'</span>, <span class="hljs-string">'object'</span>].indexOf(util.typeOf(obj)) &gt;= <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Check <a href="https://en.wikipedia.org/wiki/Endianness">big/little endian</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isLittleEndian() {
    <span class="hljs-keyword">const</span> d32 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>([<span class="hljs-number">0x01020304</span>])
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8ClampedArray</span>(d32.buffer))[<span class="hljs-number">0</span>] === <span class="hljs-number">4</span>
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3 id="math">Math</h3>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Return random int/float in [0,max) or [min,max) or [-r/2,r/2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  randomInt: max =&gt; <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * max),
  randomInt2: (min, max) =&gt; min + <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (max - min)),
  randomFloat: (max) =&gt; <span class="hljs-built_in">Math</span>.random() * max,
  randomFloat2: (min, max) =&gt; min + <span class="hljs-built_in">Math</span>.random() * (max - min),
  randomCentered: (r) =&gt; util.randomFloat2(-r / <span class="hljs-number">2</span>, r / <span class="hljs-number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Return float Gaussian normal with given mean, std deviation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  randomNormal(mean = <span class="hljs-number">0.0</span>, sigma = <span class="hljs-number">1.0</span>) { <span class="hljs-comment">// Box-Muller</span>
    <span class="hljs-keyword">const</span> [u1, u2] = [<span class="hljs-number">1.0</span> - <span class="hljs-built_in">Math</span>.random(), <span class="hljs-built_in">Math</span>.random()] <span class="hljs-comment">// ui in 0,1</span>
    <span class="hljs-keyword">const</span> norm = <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-number">-2.0</span> * <span class="hljs-built_in">Math</span>.log(u1)) * <span class="hljs-built_in">Math</span>.cos(<span class="hljs-number">2.0</span> * <span class="hljs-built_in">Math</span>.PI * u2)
    <span class="hljs-keyword">return</span> norm * sigma + mean
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Return whether num is <a href="http://goo.gl/tCfg5">Power of Two</a>. Very clever!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isPowerOf2: num =&gt; (num &amp; (num - <span class="hljs-number">1</span>)) === <span class="hljs-number">0</span>, <span class="hljs-comment">// twgl library</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Degrees &amp; Radians</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  radians: degrees =&gt; degrees * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180</span>,
  degrees: radians =&gt; radians * <span class="hljs-number">180</span> / <span class="hljs-built_in">Math</span>.PI,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Hypotenuse/distance from origin of point x,y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  distance: (x, y) =&gt; <span class="hljs-built_in">Math</span>.sqrt(x * x + y * y),</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Trims decimal digits of float to reduce size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fixed(n, digits = <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">const</span> p = <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, digits)
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.round(n * p) / p
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Clamp a number to be between min/max.
Much faster than Math.max(Math.min(v, max), min)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  clamp(v, min, max) {
    <span class="hljs-keyword">if</span> (v &lt; min) <span class="hljs-keyword">return</span> min
    <span class="hljs-keyword">if</span> (v &gt; max) <span class="hljs-keyword">return</span> max
    <span class="hljs-keyword">return</span> v
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Return true is val in [min, max] enclusive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  between: (val, min, max) =&gt; min &lt;= val &amp;&amp; val &lt;= max,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Liner interpolation .. scale in [0-1]. Lerp a standard name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lerp: (num1, num2, scale) =&gt; num1 * (<span class="hljs-number">1</span> - scale) + num2 * scale,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3 id="arrays-and-objects">Arrays and Objects</h3>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Return a new array of floats to a given precision</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fixedArray: (array, digits = <span class="hljs-number">4</span>) =&gt; array.map(n =&gt; util.fixed(n, digits)),</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Shallow clome of obj or array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  clone(obj) {
    <span class="hljs-keyword">if</span> (obj.slice) <span class="hljs-keyword">return</span> obj.slice(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">const</span> result = {}
    <span class="hljs-built_in">Object</span>.keys(obj).forEach(k =&gt; {result[k] = obj[k]})
    <span class="hljs-keyword">return</span> result
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><a href="http://goo.gl/MIaTxU">Deep clone</a> an obj or array. Clever!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  deepClone: (obj) =&gt; <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(obj)),</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Compare objects or arrays via JSON string. TypedArrays !== Arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  objectsEqual: (a, b) =&gt; <span class="hljs-built_in">JSON</span>.stringify(a) === <span class="hljs-built_in">JSON</span>.stringify(b),</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Merge from’s key/val pairs into to</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mergeObject(<span class="hljs-keyword">from</span>, to) {
    <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">from</span>).forEach(k =&gt; {to[k] = <span class="hljs-keyword">from</span>[k]})
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Return scalar max/min/sum/avg of numeric array.
Works with es6 TypedArrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  aMax: (array) =&gt; array.reduce((a, b) =&gt; <span class="hljs-built_in">Math</span>.max(a, b)),
  aMin: (array) =&gt; array.reduce((a, b) =&gt; <span class="hljs-built_in">Math</span>.min(a, b)),
  aSum: (array) =&gt; array.reduce((a, b) =&gt; a + b),
  aAvg: (array) =&gt; util.aSum(array) / array.length,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Return array composed of f(a1i, a2i) called pairwise on both arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  aPairwise: (a1, a2, f) =&gt; a1.map((val, i) =&gt; f(val, a2[i])),
  aPairSum: (a1, a2) =&gt; util.aPairwise(a1, a2, (a, b) =&gt; a + b),
  aPairDif: (a1, a2) =&gt; util.aPairwise(a1, a2, (a, b) =&gt; a - b),
  aPairMul: (a1, a2) =&gt; util.aPairwise(a1, a2, (a, b) =&gt; a * b),
  aPairEq: (a1, a2) =&gt; util.aPairDif(a1, a2).every(a =&gt; a === <span class="hljs-number">0</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Return an array normalized (lerp) between lo/hi values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalize(array, lo = <span class="hljs-number">0</span>, hi = <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> [min, max] = [<span class="hljs-keyword">this</span>.aMin(array), <span class="hljs-keyword">this</span>.aMax(array)]
    <span class="hljs-keyword">const</span> scale = <span class="hljs-number">1</span> / (max - min)
    <span class="hljs-keyword">return</span> array.map(n =&gt; <span class="hljs-keyword">this</span>.lerp(lo, hi, scale * (n - min)))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Return Uint8ClampedArray normalized in 0-255</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalize8(array) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8ClampedArray</span>(<span class="hljs-keyword">this</span>.normalize(array, <span class="hljs-number">-0.5</span>, <span class="hljs-number">255.5</span>))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Return Array normalized to integers in lo-hi</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalizeInt(array, lo, hi) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.normalize(array, lo, hi).map(n =&gt; <span class="hljs-built_in">Math</span>.round(n))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h3 id="async">Async</h3>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Return Promise for getting an image. Use:
imagePromise(‘./path/to/img.xx’).then(img =&gt; imageFcn(img))</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  imagePromise(url) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
      <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> Image()
      img.crossOrigin = <span class="hljs-string">'Anonymous'</span>
      img.onload = () =&gt; resolve(img)
      img.onerror = () =&gt; reject(<span class="hljs-string">`Could not load image <span class="hljs-subst">${url}</span>`</span>)
      img.src = url
    })
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Return Promise for ajax/xhr use.
type: ‘arraybuffer’, ‘blob’, ‘document’, ‘json’, ‘text’.
method: ‘GET’, ‘POSt’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  xhrPromise(url, type = <span class="hljs-string">'text'</span>, method = <span class="hljs-string">'GET'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
      <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()
      xhr.open(method, name) <span class="hljs-comment">// POST mainly for security and large files</span>
      xhr.responseType = type
      xhr.onload = () =&gt; resolve(xhr.response)
      xhr.onerror = () =&gt; reject(xhr.responseText)
      xhr.send()
    })
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h3 id="canvas-image">Canvas/Image</h3>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Get an image in this page by its ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getCanvasByID: id =&gt; <span class="hljs-built_in">document</span>.getElementById(id),</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Create a blank canvas of a given width/height</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createCanvas(width, height) {
    <span class="hljs-keyword">const</span> can = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>)
    can.width = width; can.height = height
    <span class="hljs-keyword">return</span> can
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>As above, but returing the context object.
Note ctx.canvas is the canvas for the ctx, and can be use as an image.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createCtx(width, height, ctxType = <span class="hljs-string">'2d'</span>) {
    <span class="hljs-keyword">const</span> can = <span class="hljs-keyword">this</span>.createCanvas(width, height)
    <span class="hljs-keyword">return</span> can.getContext(ctxType === <span class="hljs-string">'2d'</span> ? <span class="hljs-string">'2d'</span> : <span class="hljs-string">'webgl'</span>)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Return the ImageData object for this context object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ctxToImageData(ctx) {
    <span class="hljs-keyword">return</span> ctx.getImageData(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ctx.canvas.width, ctx.canvas.height)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Return an image/png base64 dataUrl string for this ctx object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ctxToDataUrl: ctx =&gt; ctx.canvas.toDataURL(<span class="hljs-string">'image/png'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Convert a dataUrl back into am image.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dataUrlToImage(dataUrl) { <span class="hljs-comment">// async in some browsers?? http://goo.gl/kIk2U</span>
    <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> Image()
    img.src = dataUrl
    <span class="hljs-keyword">return</span> img
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Return a ctx object for this base64 data url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dataUrlToCtx(dataUrl) { <span class="hljs-comment">// async in some browsers?? http://goo.gl/kIk2U</span>
    <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> Image()
    img.src = dataUrl
    <span class="hljs-keyword">const</span> ctx = <span class="hljs-keyword">this</span>.createCtx(img.width, img.height)
    ctx.drawImage(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> ctx
  },

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> util</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
