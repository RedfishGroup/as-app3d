<!DOCTYPE html>

<html>
<head>
  <title>util.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="AgentSet.html">
                  AgentSet.js
                </a>
              
                
                <a class="source" href="Color.html">
                  Color.js
                </a>
              
                
                <a class="source" href="ColorMap.html">
                  ColorMap.js
                </a>
              
                
                <a class="source" href="DataSet.html">
                  DataSet.js
                </a>
              
                
                <a class="source" href="OofA.html">
                  OofA.js
                </a>
              
                
                <a class="source" href="util.html">
                  util.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>util.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>A set of useful misc utils which will eventually move to individual modules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> util = {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h3 id="types">Types</h3>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Fixing the javascript <a href="https://goo.gl/Efdzk5">typeof operator</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  typeOf: (obj) =&gt; ({}).toString.call(obj).match(<span class="hljs-regexp">/\s(\w+)/</span>)[<span class="hljs-number">1</span>].toLowerCase(),</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Is obj Array or Object (but not typed array)?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isAorO: (obj) =&gt; [<span class="hljs-string">'array'</span>, <span class="hljs-string">'object'</span>].indexOf(util.typeOf(obj)) &gt;= <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Is obj TypedArray? If obj.buffer not present, works .. type is ‘undefined’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isTypedArray: (obj) =&gt; util.typeOf(obj.buffer) === <span class="hljs-string">'arraybuffer'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Is a number an integer (rather than a float w/ non-zero fractional part)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isInteger: <span class="hljs-built_in">Number</span>.isInteger || ((num) =&gt; <span class="hljs-built_in">Math</span>.floor(num) === num),</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Check <a href="https://en.wikipedia.org/wiki/Endianness">big/little endian</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isLittleEndian () {
    <span class="hljs-keyword">const</span> d32 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>([<span class="hljs-number">0x01020304</span>])
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8ClampedArray</span>(d32.buffer))[<span class="hljs-number">0</span>] === <span class="hljs-number">4</span>
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Throw an error with string.
Use instead of <code>throw message</code> for better debugging</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  error: (message) =&gt; { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(message) },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Return identity fcn, returning its argument unchanged. Used in callbacks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  identity: (o) =&gt; o,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Return function returning an object’s property.  Property in fcn closure.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  propFcn: (prop) =&gt; (o) =&gt; o[prop],</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Convert Array or TypedArray to given Type (Array or TypedArray).
If array is already of correct type, return it unmodified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  convertArray (array, Type) {
    <span class="hljs-keyword">const</span> Type0 = array.constructor
    <span class="hljs-keyword">if</span> (Type0 === Type) <span class="hljs-keyword">return</span> array <span class="hljs-comment">// return array if already same Type</span>
    <span class="hljs-keyword">if</span> (Type !== <span class="hljs-built_in">Array</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Type(array) <span class="hljs-comment">// TypedArray: universal ctor</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.prototype.slice.call(array) <span class="hljs-comment">// Convert TypedArray to Array</span>
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3 id="debug">Debug</h3>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Use chrome/ffox/ie console.time()/timeEnd() performance functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  timeit (f, runs = <span class="hljs-number">1e5</span>, name = <span class="hljs-string">'test'</span>) {
    <span class="hljs-built_in">console</span>.time(name) <span class="hljs-comment">// eslint-disable-line</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; runs; i++) f(i)
    <span class="hljs-built_in">console</span>.timeEnd(name) <span class="hljs-comment">// eslint-disable-line</span>
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Print Prototype Stack</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pps (obj, title = <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">if</span> (title) <span class="hljs-built_in">console</span>.log(title)   <span class="hljs-comment">// eslint-disable-line</span>
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">1</span>
    <span class="hljs-keyword">let</span> str = <span class="hljs-string">''</span>
    <span class="hljs-keyword">while</span> (obj) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">'function'</span>) {
        str = obj.constructor.toString()
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">let</span> okeys = <span class="hljs-built_in">Object</span>.keys(obj)
        str = okeys.length &gt; <span class="hljs-number">0</span> ? <span class="hljs-comment">// eslint-disable-line</span>
          <span class="hljs-string">`[<span class="hljs-subst">${okeys.join(', ')}</span>]`</span> : <span class="hljs-string">`[<span class="hljs-subst">${obj.constructor.name}</span>]`</span>
      }
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`[<span class="hljs-subst">${count++}</span>]: <span class="hljs-subst">${str}</span>`</span>)   <span class="hljs-comment">// eslint-disable-line</span>
      obj = <span class="hljs-built_in">Object</span>.getPrototypeOf(obj)
    }
  },

  arraysToString (arrays) {
    <span class="hljs-keyword">let</span> str = <span class="hljs-string">''</span>
    <span class="hljs-keyword">this</span>.repeat(arrays.length, (i) =&gt; { str += <span class="hljs-string">`[<span class="hljs-subst">${arrays[i]}</span>]`</span> })
    <span class="hljs-keyword">return</span> str
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3 id="html-css-dom">HTML, CSS, DOM</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  parseQueryString () {
    <span class="hljs-keyword">const</span> results = {}
    <span class="hljs-keyword">const</span> query = <span class="hljs-built_in">document</span>.location.search.substring(<span class="hljs-number">1</span>)
    query.split(<span class="hljs-string">'&amp;'</span>).forEach((s) =&gt; {
      <span class="hljs-keyword">const</span> param = s.split(<span class="hljs-string">'='</span>)
      results[param[<span class="hljs-number">0</span>]] = (param.length === <span class="hljs-number">1</span>) ? <span class="hljs-literal">true</span> : param[<span class="hljs-number">1</span>]
    })
    <span class="hljs-keyword">return</span> results
  },

  setScript (path) {
    <span class="hljs-keyword">const</span> scriptTag = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>)
    scriptTag.src = path
    <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'head'</span>).appendChild(scriptTag)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h3 id="math">Math</h3>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Return random int/float in [0,max) or [min,max) or [-r/2,r/2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  randomInt: (max) =&gt; <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * max),
  randomInt2: (min, max) =&gt; min + <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (max - min)),
  randomFloat: (max) =&gt; <span class="hljs-built_in">Math</span>.random() * max,
  randomFloat2: (min, max) =&gt; min + <span class="hljs-built_in">Math</span>.random() * (max - min),
  randomCentered: (r) =&gt; util.randomFloat2(-r / <span class="hljs-number">2</span>, r / <span class="hljs-number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Return float Gaussian normal with given mean, std deviation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  randomNormal (mean = <span class="hljs-number">0.0</span>, sigma = <span class="hljs-number">1.0</span>) { <span class="hljs-comment">// Box-Muller</span>
    <span class="hljs-keyword">const</span> [u1, u2] = [<span class="hljs-number">1.0</span> - <span class="hljs-built_in">Math</span>.random(), <span class="hljs-built_in">Math</span>.random()] <span class="hljs-comment">// ui in 0,1</span>
    <span class="hljs-keyword">const</span> norm = <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-number">-2.0</span> * <span class="hljs-built_in">Math</span>.log(u1)) * <span class="hljs-built_in">Math</span>.cos(<span class="hljs-number">2.0</span> * <span class="hljs-built_in">Math</span>.PI * u2)
    <span class="hljs-keyword">return</span> norm * sigma + mean
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Return whether num is <a href="http://goo.gl/tCfg5">Power of Two</a>. Very clever!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isPowerOf2: (num) =&gt; (num &amp; (num - <span class="hljs-number">1</span>)) === <span class="hljs-number">0</span>, <span class="hljs-comment">// twgl library</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Degrees &amp; Radians</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  radians: (degrees) =&gt; degrees * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180</span>,
  degrees: (radians) =&gt; radians * <span class="hljs-number">180</span> / <span class="hljs-built_in">Math</span>.PI,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Hypotenuse/distance from origin of point x,y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  distance: (x, y) =&gt; <span class="hljs-built_in">Math</span>.sqrt(x * x + y * y),</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Trims decimal digits of float to reduce size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fixed (n, digits = <span class="hljs-number">4</span>) {
    <span class="hljs-keyword">const</span> p = <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, digits)
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.round(n * p) / p
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Clamp a number to be between min/max.
Much faster than Math.max(Math.min(v, max), min)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  clamp (v, min, max) {
    <span class="hljs-keyword">if</span> (v &lt; min) <span class="hljs-keyword">return</span> min
    <span class="hljs-keyword">if</span> (v &gt; max) <span class="hljs-keyword">return</span> max
    <span class="hljs-keyword">return</span> v
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Return true is val in [min, max] enclusive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  between: (val, min, max) =&gt; min &lt;= val &amp;&amp; val &lt;= max,</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Return a linear interpolation between lo and hi.
Scale is in [0-1], a percentage, and the result is in [lo,hi]
If lo&gt;hi, scaling is from hi end of range.
<a href="http://goo.gl/QrzMc">Why the name <code>lerp</code>?</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lerp: (lo, hi, scale) =&gt;
    lo &lt;= hi ? lo + (hi - lo) * scale : lo - (lo - hi) * scale,</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Calculate the lerp scale given lo/hi pair and a number between them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lerpScale: (number, lo, hi) =&gt; (number - lo) / (hi - lo),</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h3 id="arrays-objects-and-iteration">Arrays, Objects and Iteration</h3>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Shim for Object.setPrototypeOf for legacy use.
Support for <strong>proto</strong> currently greater, oddly enough.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setPrototypeOf (obj, prototype) {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.setPrototypeOf)
      <span class="hljs-built_in">Object</span>.setPrototypeOf(obj, prototype)
    <span class="hljs-keyword">else</span>
      obj.__proto__ = prototype <span class="hljs-comment">// eslint-disable-line</span>
    <span class="hljs-keyword">return</span> obj
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Execute fcn for all own member of an obj or array (typed OK).</p>
<ul>
<li>Unlike forEach, does not skip undefines.</li>
<li>Like map, forEach, etc, fcn = fcn(item, key/index, obj).</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  forAll (arrayOrObj, fcn) {
    <span class="hljs-keyword">if</span> (arrayOrObj.slice) <span class="hljs-comment">// typed &amp; std arrays</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, len = arrayOrObj.length; i &lt; len; i++)
        fcn(arrayOrObj[i], i, arrayOrObj)
    <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">Object</span>.keys(arrayOrObj).forEach((k) =&gt; fcn(arrayOrObj[k], k, arrayOrObj))
    <span class="hljs-keyword">return</span> arrayOrObj
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Repeat function f(i) n times, n in 0, i-1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  repeat (n, f) { <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) f(i) },</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Repeat function n/step times, incrementing i by step each step.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  step (n, step, f) { <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i += step) f(i) },</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Return a new copy of array, with correct type.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyArray (array) {
    <span class="hljs-keyword">if</span> (array.constructor === <span class="hljs-built_in">Array</span>) <span class="hljs-keyword">return</span> array.slice(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> array.constructor(array)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Return a new array that is the concatination two arrays.
The resulting type is that of the first array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  concatArrays (array1, array2) {
    <span class="hljs-keyword">const</span> Type = array1.constructor
    <span class="hljs-keyword">if</span> (Type === <span class="hljs-built_in">Array</span>)
      <span class="hljs-keyword">return</span> array1.concat(<span class="hljs-keyword">this</span>.convertArray(array2, <span class="hljs-built_in">Array</span>))
    <span class="hljs-keyword">const</span> array = <span class="hljs-keyword">new</span> Type(array1.length + array2.length)</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Note typedArray.set() allows any Array or TypedArray array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    array.set(array1); array.set(array2, array1.length)
    <span class="hljs-keyword">return</span> array
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Return array’s type (Array or TypedArray variant)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  arrayType (array) { <span class="hljs-keyword">return</span> array.constructor },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Return a new JavaScript Array of floats to a given precision.
Fails for Float32Array due to float64-&gt;32 artifiacts, thus Array conversion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fixedArray (array, digits = <span class="hljs-number">4</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>const a = (array.constructor === Array) ?
  array : Array.prototype.slice.call(array) // see <a href="https://goo.gl/UcIrGZ">https://goo.gl/UcIrGZ</a>
return a.map(n =&gt; util.fixed(n, digits))</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> array.map((n) =&gt; util.fixed(n, digits))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Shallow clome of obj or array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  clone (obj) {
    <span class="hljs-keyword">if</span> (obj.slice) <span class="hljs-keyword">return</span> obj.slice(<span class="hljs-number">0</span>) <span class="hljs-comment">// ok for TypedArrays</span>
    <span class="hljs-keyword">const</span> result = {}
    <span class="hljs-built_in">Object</span>.keys(obj).forEach((k) =&gt; { result[k] = obj[k] })
    <span class="hljs-keyword">return</span> result
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><a href="http://goo.gl/MIaTxU">Deep clone</a> an obj or array. Clever!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  deepClone: (obj) =&gt; <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(obj)),</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Compare Objects or Arrays via JSON string. TypedArrays !== Arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  objectsEqual: (a, b) =&gt; <span class="hljs-built_in">JSON</span>.stringify(a) === <span class="hljs-built_in">JSON</span>.stringify(b),</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Merge from’s key/val pairs into to
REMIND: use Object.assign</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyTo (toObj, fromObj) {
    <span class="hljs-built_in">Object</span>.keys(fromObj).forEach((k) =&gt; { toObj[k] = fromObj[k] })
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Returns new array (of this type) of unique elements in this <em>sorted</em> array.
Sort or clone &amp; sort if needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  uniq (array) {
    <span class="hljs-keyword">const</span> f = (ai, i, a) =&gt; ai !== a[i - <span class="hljs-number">1</span>] <span class="hljs-comment">// a[-1] ok, is undefined, no error</span>
    <span class="hljs-keyword">return</span> array.filter(f)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Create random array of floats between min/max.
Array Type allows conversion to integers (Int32Array etc)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  randomArray (length, min = <span class="hljs-number">0</span>, max = <span class="hljs-number">1</span>, Type = <span class="hljs-built_in">Array</span>) {
    <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">new</span> Type(length)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) { a[i] = <span class="hljs-keyword">this</span>.randomFloat2(min, max) }
    <span class="hljs-keyword">return</span> a
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Create an array of properties from an array of objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  propArray: (array, propName) =&gt; array.map((a) =&gt; a[propName]),</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Create a histogram, given an array, a bin size, and a
min bin defaulting to min of of the array.
Return an object with:</p>
<ul>
<li>min/maxBin: the first/last bin with data</li>
<li>min/maxVal: the min/max values in the array</li>
<li>bins: the number of bins</li>
<li>hist: the array of bins</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  histogram (array, bin = <span class="hljs-number">1</span>, min = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-keyword">this</span>.aMin(array))) {
    <span class="hljs-keyword">const</span> hist = []
    <span class="hljs-keyword">let</span> [minBin, maxBin] = [<span class="hljs-built_in">Number</span>.MAX_VALUE, <span class="hljs-built_in">Number</span>.MIN_VALUE]
    <span class="hljs-keyword">let</span> [minVal, maxVal] = [<span class="hljs-built_in">Number</span>.MAX_VALUE, <span class="hljs-built_in">Number</span>.MIN_VALUE]
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> a <span class="hljs-keyword">of</span> array) {
      <span class="hljs-keyword">const</span> i = <span class="hljs-built_in">Math</span>.floor(a / bin) - min
      hist[i] = (hist[i] === <span class="hljs-literal">undefined</span>) ? <span class="hljs-number">1</span> : hist[i] + <span class="hljs-number">1</span>
      minBin = <span class="hljs-built_in">Math</span>.min(minBin, i)
      maxBin = <span class="hljs-built_in">Math</span>.max(maxBin, i)
      minVal = <span class="hljs-built_in">Math</span>.min(minVal, a)
      maxVal = <span class="hljs-built_in">Math</span>.max(maxVal, a)
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> i <span class="hljs-keyword">in</span> hist)
      <span class="hljs-keyword">if</span> (hist[i] === <span class="hljs-literal">undefined</span>) { hist[i] = <span class="hljs-number">0</span> }
    <span class="hljs-keyword">const</span> bins = maxBin - minBin + <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> { bins, minBin, maxBin, minVal, maxVal, hist }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Return scalar max/min/sum/avg of numeric array.
Works with es6 TypedArrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  aMax: (array) =&gt; array.reduce((a, b) =&gt; <span class="hljs-built_in">Math</span>.max(a, b)),
  aMin: (array) =&gt; array.reduce((a, b) =&gt; <span class="hljs-built_in">Math</span>.min(a, b)),
  aSum: (array) =&gt; array.reduce((a, b) =&gt; a + b),
  aAvg: (array) =&gt; util.aSum(array) / array.length,</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>You’d think this wasn’t necessary, and I always forget. Damn.
Note this, like sort, sorts in place. Clone array if needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sortNums (array, ascending = <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">return</span> array.sort((a, b) =&gt; ascending ? a - b : b - a)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>sort an array of objects w/ fcn(obj) as compareFunction.
If fcn is a string, convert to propFcn.
See <a href="https://goo.gl/fWNFf">Fisher-Yates-Knuth shuffle</a> for better approach</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sortObjs (array, fcn, ascending = <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fcn === <span class="hljs-string">'string'</span>) fcn = <span class="hljs-keyword">this</span>.propFcn(fcn)
    <span class="hljs-keyword">const</span> comp = (a, b) =&gt; {
      <span class="hljs-keyword">if</span> (fcn(a) &gt; fcn(b)) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
      <span class="hljs-keyword">if</span> (fcn(a) &lt; fcn(b)) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    }
    <span class="hljs-keyword">return</span> array.sort((a, b) =&gt; ascending ? comp(a, b) : -comp(a, b))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Randomize array in-place. Use clone() first if new array needed
The array is returned for chaining; same as input array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shuffle (array) { array.sort((a, b) =&gt; <span class="hljs-built_in">Math</span>.random() &lt; <span class="hljs-number">0.5</span>); <span class="hljs-keyword">return</span> array },</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Return array composed of f(a1i, a2i) called pairwise on both arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  aPairwise: (a1, a2, f) =&gt; a1.map((val, i) =&gt; f(val, a2[i])),
  aPairSum: (a1, a2) =&gt; util.aPairwise(a1, a2, (a, b) =&gt; a + b),
  aPairDif: (a1, a2) =&gt; util.aPairwise(a1, a2, (a, b) =&gt; a - b),
  aPairMul: (a1, a2) =&gt; util.aPairwise(a1, a2, (a, b) =&gt; a * b),
  aPairEq: (a1, a2) =&gt; util.aPairDif(a1, a2).every((a) =&gt; a === <span class="hljs-number">0</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Return a “ramp” (array of uniformly ascending/descending floats)
in [start,stop] with numItems (positive integer &gt; 1).
OK for start&gt;stop. Will always include start/stop w/in float accuracy.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  aRamp (start, stop, numItems) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Note: start + step*i, where step is (stop-start)/(numItems-1),
has float accuracy problems, must recalc step each iteration.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (numItems &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">this</span>.error(<span class="hljs-string">'aRamp: numItems must be &gt; 1'</span>)
    <span class="hljs-keyword">const</span> a = []
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numItems; i++)
      a.push(start + (stop - start) * (i / (numItems - <span class="hljs-number">1</span>)))
    <span class="hljs-keyword">return</span> a
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Integer version of aRamp, start &amp; stop integers, rounding each element.
Default numItems yields unit step between start &amp; stop.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  aIntRamp (start, stop, numItems = (<span class="hljs-built_in">Math</span>.abs(stop - start) + <span class="hljs-number">1</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.aRamp(start, stop, numItems).map(a =&gt; <span class="hljs-built_in">Math</span>.round(a))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Return an array normalized (lerp) between lo/hi values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalize (array, lo = <span class="hljs-number">0</span>, hi = <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> [min, max] = [<span class="hljs-keyword">this</span>.aMin(array), <span class="hljs-keyword">this</span>.aMax(array)]
    <span class="hljs-keyword">const</span> scale = <span class="hljs-number">1</span> / (max - min)
    <span class="hljs-keyword">return</span> array.map((n) =&gt; <span class="hljs-keyword">this</span>.lerp(lo, hi, scale * ((n) - min)))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Return Uint8ClampedArray normalized in 0-255</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalize8 (array) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8ClampedArray</span>(<span class="hljs-keyword">this</span>.normalize(array, <span class="hljs-number">-0.5</span>, <span class="hljs-number">255.5</span>))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Return Array normalized to integers in lo-hi</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalizeInt (array, lo, hi) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.normalize(array, lo, hi).map((n) =&gt; <span class="hljs-built_in">Math</span>.round(n))
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h3 id="async">Async</h3>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Return Promise for getting an image.</p>
<ul>
<li>use: imagePromise(‘./path/to/img’).then(img =&gt; imageFcn(img))</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  imagePromise (url) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
      <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> Image()
      img.crossOrigin = <span class="hljs-string">'Anonymous'</span>
      img.onload = () =&gt; resolve(img)
      img.onerror = () =&gt; reject(<span class="hljs-string">`Could not load image <span class="hljs-subst">${url}</span>`</span>)
      img.src = url
    })
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Return Promise for ajax/xhr data.</p>
<ul>
<li>type: ‘arraybuffer’, ‘blob’, ‘document’, ‘json’, ‘text’.</li>
<li>method: ‘GET’, ‘POST’</li>
<li>use: xhrPromise(‘./path/to/data’).then(data =&gt; dataFcn(data))</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  xhrPromise (url, type = <span class="hljs-string">'text'</span>, method = <span class="hljs-string">'GET'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
      <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()
      xhr.open(method, url) <span class="hljs-comment">// POST mainly for security and large files</span>
      xhr.responseType = type
      xhr.onload = () =&gt; resolve(xhr.response)
      xhr.onerror = () =&gt; reject(xhr.responseText)
      xhr.send()
    })
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>An <a href="https://davidwalsh.name/async-generators">async/await</a>
implementation using generators returning promises.</p>
<p>runGenerator runs a generator which yields promises,
returning the promise results when they complete.
Amazingly enough, the returned promise result replaces the
promise initially yielded by the generator function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  runGenerator (g) {
    <span class="hljs-keyword">const</span> it = g()
    ;(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iterate</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-comment">// asynchronously iterate over generator</span>
      <span class="hljs-keyword">const</span> ret = it.next(val)
      <span class="hljs-keyword">if</span> (!ret.done) {
        ret.value.then(iterate) <span class="hljs-comment">// wait on the promise</span>
      }
    }())
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Used like this, main() is entirely sync:</p>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> path = <span class="hljs-string">'http://s3.amazonaws.com/backspaces/'</span>
  <span class="hljs-keyword">var</span> val1 = <span class="hljs-keyword">yield</span> util.xhrPromise(path + <span class="hljs-string">'lorem1.txt'</span>)
  <span class="hljs-built_in">console</span>.log( <span class="hljs-string">'val1'</span>, val1 )
  <span class="hljs-keyword">var</span> val2 = <span class="hljs-keyword">yield</span> util.xhrPromise(path + <span class="hljs-string">'lorem2.txt'</span>)
  <span class="hljs-built_in">console</span>.log( <span class="hljs-string">'val2'</span>, val2 )
}
util.runGenerator( main )
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <h3 id="canvas-image">Canvas/Image</h3>

            </div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Get an image in this page by its ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getCanvasByID: (id) =&gt; <span class="hljs-built_in">document</span>.getElementById(id),</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Create a blank canvas of a given width/height</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createCanvas (width, height) {
    <span class="hljs-keyword">const</span> can = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>)
    can.width = width; can.height = height
    <span class="hljs-keyword">return</span> can
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>As above, but returing the context object.
Note ctx.canvas is the canvas for the ctx, and can be use as an image.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createCtx (width, height, ctxType = <span class="hljs-string">'2d'</span>) {
    <span class="hljs-keyword">const</span> can = <span class="hljs-keyword">this</span>.createCanvas(width, height)
    <span class="hljs-keyword">return</span> can.getContext(ctxType === <span class="hljs-string">'2d'</span> ? <span class="hljs-string">'2d'</span> : <span class="hljs-string">'webgl'</span>)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Return the ImageData object for this context object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ctxToImageData (ctx) {
    <span class="hljs-keyword">return</span> ctx.getImageData(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ctx.canvas.width, ctx.canvas.height)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Return an image/png base64 <a href="https://goo.gl/fyBPnL">dataUrl</a>
string for this ctx object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ctxToDataUrl: (ctx) =&gt; ctx.canvas.toDataURL(<span class="hljs-string">'image/png'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Convert a dataUrl back into am image.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dataUrlToImage (dataUrl) { <span class="hljs-comment">// async in some browsers?? http://goo.gl/kIk2U</span>
    <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> Image()
    img.src = dataUrl
    <span class="hljs-keyword">return</span> img
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Return a ctx object for this base64 data url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dataUrlToCtx (dataUrl) { <span class="hljs-comment">// async in some browsers?? http://goo.gl/kIk2U</span>
    <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">this</span>.dataUrlToImage(dataUrl)
    <span class="hljs-keyword">const</span> ctx = <span class="hljs-keyword">this</span>.createCtx(img.width, img.height)
    ctx.drawImage(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> ctx
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Get element (i.e. canvas) relative x,y position from event/mouse position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getEventXY (element, evt) { <span class="hljs-comment">// http://goo.gl/356S91</span>
    <span class="hljs-keyword">const</span> rect = element.getBoundingClientRect()
    <span class="hljs-keyword">return</span> { x: evt.clientX - rect.left, y: evt.clientY - rect.top }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Convert an image to a context. img may be a canvas.</p>
<ul>
<li>x, y are origin in image, default to 0, 0.</li>
<li>width, height are size of context, default to image’s width, height</li>
<li>thus default is entire image</li>
</ul>
<p>Note: to convert a ctx to an “image” (drawImage) use ctx.canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  imageToCtx (img, x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>, width = img.width, height = img.height) {
    <span class="hljs-keyword">if</span> ((x + width &gt; img.width) || (y + height &gt; img.height))
      <span class="hljs-keyword">this</span>.error(<span class="hljs-string">'imageToCtx: parameters outside of image'</span>)
    <span class="hljs-keyword">const</span> ctx = <span class="hljs-keyword">this</span>.createCtx(width, height)
    ctx.drawImage(img, x, y, width, height, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height)
    <span class="hljs-keyword">return</span> ctx
  }

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> util</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
